# 总线

## 定义
一组能为多个部件分时共享的公共信息传送线路

总线由若干根传输线或通路组成

## 特点
* 分时； 同一时刻仅允许一个部件向总线发送信息
* 共享； 总线上可以挂接多个部件，各个部件之间互相交换的信息都通过这段线路分时共享

## 猝（突）发传送方式
传送数据块首地址，然后传送多个数据，不需要每次都传送地址

</br>

# P43 总线分类
按连接部件的不同，分为以下三类
![总线的分类](https://raw.githubusercontent.com/Juston007/ComputerOrganization/main/Review/img/chapter2/%E6%80%BB%E7%BA%BF%E7%9A%84%E5%88%86%E7%B1%BB.jpg)
## 片内总线
CPU芯片内部；寄存器之间；寄存器与ALU之间
## 系统总线
计算机系统各大部件（CPU、主存、IO接口）之间相互连接的总线

这些部件都安放在主板上，故又称板级（间）总线
## 通信总线
计算机系统之间与其他系统之间传送信息的总线

</br>

# 系统总线
按系统总线传输信息的不同，可分为以下三类
## 数据总线（双向传输总线）
传输各部件之间的数据信息；位数与机器字长、存储字长有关
## 地址总线（单向传输总线）
用来指出数据总线上的源数据和目的数据所在的主存单元或IO接口的地址；位数与主存地址空间有关
## 控制总线
传输控制信息；包括CPU送出的控制命令和主存（外设）返回CPU的反馈信号

<br>

# P44 通信总线
这类总线用于计算机系统之间或计算机系统与其他系统之间的通信；

按传输方式分为两类：
## 串行通信
数据在单条1位宽的传输线上，一位一位地按顺序分时传送

## 并行通信
数据在多条并行1位宽的传输线上，同时由源传送到目的地

<br>

# 总线性能指标 (了解；判断)
## 总线周期
一次总线所需要的时间（申请阶段、寻址阶段、传输阶段和结束阶段），通常由若干个时钟周期组成
## 工作频率
总线上各种操作的频率，为总线周期的倒数。实际上指一秒传送几次数据
## 时钟周期
机器有一个统一的时钟，定时产生时钟信号，以控制整个机器各部件，一次时钟所花费的时间
## 时钟频率
为时钟周期的倒数，实际上指一秒有多少个时钟周期
## 总线位宽
总线上能够同时传输的数据位数，通常是指总线的根数，用位（bit）表示
## 总线带宽
总线的数据传输率，即单位时间内总线上可传输的数据的位数，单位用MBps（兆字节每秒）
## 总线复用
一种信号线在不同的时间传输不同的信息；在一条物理线路上分时传送地址信号和数据信号，即为总线的多路复用
## 信号线数
地址总线、数据总线和控制总线三种总线数总和
## 时钟同步/异步
总线上的数据与时钟同步工作的称为同步总线，与时钟不同步工作的称为异步总线
## 总线控制方式
包括突发工作、自动配置、仲裁方式、逻辑方式、计数方式等

<br>

# 总线仲裁
总线上连接的各类设备，按其对总线有无控制功能可分为主设备（模块）和从设备（模块）

* 主设备 （master） 对总线有控制权
* 从设备 （slave）  响应主设备发送来的命令

总线上的信息传送由主设备启动，若某个主设备欲与另一个从设备发起通信时，需要先由主设备发出总线请求信号

若多个设备同时要使用总线时，就由总线控制器的判优、仲裁逻辑按一定的优先等级顺序确定哪个主设备能使用总线

判优控制分为集中式和分布式

## 集中仲裁方式
* 链式查询方式 
* 计时器定时查询方式
* 独立请求方式

## 链式查询方式

![链式查询方式](https://raw.githubusercontent.com/Juston007/ComputerOrganization/main/Chapter3_Bus/img/%E9%93%BE%E5%BC%8F%E6%9F%A5%E8%AF%A2%E6%96%B9%E5%BC%8F.jpg)

BS （bus busy）     总线忙

BR （bus request）  总线请求

BG （bus agree）    总线允许

总线上所有部件共用总线请求线（BR），有部件请求使用总线时，通过BR发送请求信号到总线控制器；总线控制器检查总线，若不忙，则立即发送总线响应信号，经BG串行的从一个部件传送的另一个部件，依次查询，直到响应信号到达的部件有请求；

优点：
* 链式查询优先级固定（部件离总线控制器越近，其优先级越高）；
* 只需要几根线就能按照一定优先次序实现总线控制；
* 结构简单，扩充容易；

缺点：
* 对硬件电路故障比较敏感，并且优先级不可改变；
* 当优先级高的部件频繁的请求使用总线时，优先级部件较低的部件无法使用；

</br>

## 计时器定时查询方式

![计时器定时查询](https://raw.githubusercontent.com/Juston007/ComputerOrganization/main/Chapter3_Bus/img/%E8%AE%A1%E6%95%B0%E5%99%A8%E5%AE%9A%E6%97%B6%E6%9F%A5%E8%AF%A2.jpg)

结构特点：用一个计数器控制总线使用权，相对链式查询多了一组设备地址线，少了一根总线响应线（BG），仍然共用一根总线请求线（BR）；

当总线控制器收到请求信号并判断总线空闲时，计时器开始计数，计数值通过设备地址线发送到各个部件；当地址线上的计数值与请求请求总线设备的地址一致时，该设备获得总线访问权，此时停止计数和查询；

优点：
1. 计数初始值可以改变优先次序
2. 对电路的故障没有链式查询方式敏感

缺点：
1. 增加了控制线数，若设备有n个，则需要floor(log2(n))条控制线
2. 控制相比链式查询方式更复杂

计数值的设置
* 计数每次从0开始，设备的优先级就按顺序排列，固定不变
* 计数从上一次终点开始，此时设备使用总线的优先次数相等
* 计数值初值还可由程序设置

</br>

## 独立请求方式

![独立请求方式](https://raw.githubusercontent.com/Juston007/ComputerOrganization/main/Chapter3_Bus/img/%E7%8B%AC%E7%AB%8B%E8%AF%B7%E6%B1%82%E6%96%B9%E5%BC%8F.jpg)

优点：
1. 响应速度更快，总线允许信号（BG）直接从控制器发送到有关设备，不必再设备间传输或查询
2. 对优先次序的控制相当灵活

缺点：
1. 控制线数量多；若有n个设备，则需要2n条控制线；（BG+BR）
2. 总线的控制逻辑更加复杂

<br>

# 异步通信
![异步通信](https://raw.githubusercontent.com/Juston007/ComputerOrganization/main/Review/img/chapter2/%E5%BC%82%E6%AD%A5%E9%80%9A%E4%BF%A1.jpg)

<br>

# P61 例3.1
假设总线的时钟频率为100MHz，总线的传输周期为4个时钟周期，总线的宽度为32位，试求总线的速度传输率；若想提高一倍的数据传输率，可采取什么措施？

## 解答
根据题意可知，传输频率为 25MHz (100MHz / 4)

还有总线宽度为32位

根据公式可计算出数据传输率为 100MBps (25MHz * 32位 = 800Mbps)

## 解答2
如果要提高一倍的传输速率，可以从时钟频率、传输周期和总线宽度三个方面入手

数据传输率 = (时钟频率 / 传输周期) * 总线宽度

这三个参数随便那个乘与2都可以

* (200MHz / 4) * 32位
* (100MHz / 2) * 32位
* (100MHz / 4) * 64位

<br>

# P62 例3.2
在异步串行传输系统中，假设每秒传输120个数据帧，其字符格式规定包含1个起始位、7个数据位、1个奇偶校验位、1个终止位，试计算波特率；

## 解答
一个字符共包含10（1+7+1+1）个数据位

波特率指定的每秒传送的码元个数（这里我们认为一个码元携带1个数据位）

每秒传送120个数据帧（字符）

波特率为120 * 10 = 1200baud

<br>

# P64 例3.4
在异步串行传输系统中，若字符格式为1位起始位、8位数据位、1位奇偶校验位、1位终止位；假设波特率位1200bps，求这时的比特率；

## 解答
根据题目可以知道，一个字符有效位为8位，而传送一个字符需要11位(1 + 8 + 1 + 1)

比特率指的是每秒传送的有效数据位数

波特率指定的每秒传送的码元个数（这里我们认为一个码元携带1个数据位）

则比特率为 1200 * (8 / 11) = 872.72bps

<br>