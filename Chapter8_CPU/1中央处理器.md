# P337 CPU的功能
负责协调并控制计算机各部件执行程序的指令序列，其基本功能是取指令、分析指令和执行指令

此外，控制器还必须能控制程序的输入和运算结果的输出（即控制主机与IO设备交换信息）以及对总线的管理，甚至能处理机器运行过程中出现的异常情况（如掉电）和特殊请求（如打印机请求打印一行字符），即处理中断的能力

# P338 CPU的寄存器
![CPU的寄存器]()

# P342 指令周期
CPU每取出并执行一条指令所需要的全部时间称之为指令周期

## 取指周期
取指阶段完成取指令和分析指令的操作，又称取指周期

## 执行周期
执行阶段完成执行指令的操作，又称执行周期

## 间址周期
此外，当遇到间接寻址的指令时，由于指令中只给出了操作数有效地址的地址，为了取操作数需要先访问一次存储器，取出有效地址，然后再访问存储器，取出操作数

间址周期用于取操作数的有效地址，因此间址周期介于取指周期和执行周期之间

## 中断周期
CPU在每条指令执行阶段结束前，都要发出中断查询信号，以检测是否又某个IO设备提出中断请求

## 取指周期数据流

## 间址周期数据流

## 中断周期数据流


# P346 指令流水
## 原理
指令流水线类似于工厂的装配线，装配线利用了产品再装配的不同阶段其装配过程不同这一特点，使不同的产品处于不同的装配线上，即每个装配段同时对不同产品进行加功能，大大提高了装配效率

* 由指令部件取出一条指令，并将它暂存起来
* 如果执行部件空闲，就将暂存的指令传给执行部件执行
* 与此同时，指令部件又可以取出下一条指令并暂存起来，这称为指令预取】
* 如果取指和执行阶段完全重叠，相当于指令周期减半，不过这不现实

指令的执行时间一般大于取指时间；当遇到转移指令时，下一条指令是不可知的

指令分了m个阶段，也就可以m级流水


## 性能
### 吞吐率（Throughput Rate）
指令级流水线中，吞吐率时指单位时间内流水线所完成指令或输出结果的数量

### 加速比（Speedup Ratio）
m段流水线的速度与等功能的非流水线的速度之比

### 效率（Efficiency）
流水线中各功能段的利用率；

由于流水线有建立时间和排空时间，因此各功能段的设备不可能一致处于工作状态

## 影响其性能的因素
### 结构相关
指令在重叠执行过程中，不同指令争用同一功能部件产生资源冲突时产生的

解决冲突的办法：
* 让流水线在完成前一条指令对数据的存储器访问时，暂停（一个时钟周期）取后一条指令的操作
* 设置两个独立的存储器分别存放操作数和指令

### 数据相关；
指令在重叠执行过程中，可能改变对操作数的读写访问顺序，从而导致了数据相关冲突

* RAW
* WAR
* WAW

解决冲突的办法：
* 采用后推法，即将相关指令延迟到所需操作数被写回到寄存器后再执行的方式
* 采用定向技术，又称为旁路技术或相关专用通路技术

### 控制相关；
控制相关主要由转移指令引起的

# P354 例8.1
# P355 例8.3
# P355 例8.4
# P358 中断
# P368 例8.2